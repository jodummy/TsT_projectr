<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="TST_teamproject.team.dao.TeamMapper">
   <!-- 11.04 팀 검색 및 페이징 -->
   <select id="teamList" resultType="TST_teamproject.team.model.TeamVo">
      SELECT 
                  TST_TEAM_NO, 
                  TST_TEAM_NAME, 
                  TST_TEAM_TYPE, 
                  TST_TEAM_LOCATION, 
                  TST_USER_NICKNAME,
                  TST_TEAM_CONTENT, 
                  TST_TEAM_WIN, 
                  TST_TEAM_LOSE, 
                  TST_TEAM_AGE
      FROM 
                  TST_TEAM
                  
   <if test="keyword != null">
      WHERE 
      TST_TEAM_NAME 
      LIKE CONCAT 
                  ('%', #{keyword}, '%') 
      OR 
      TST_TEAM_TYPE 
      LIKE CONCAT
                  ('%', #{keyword}, '%')
   </if>
      LIMIT
                  #{ startList },
                  #{ listSize }
                  
   </select>
   
   <!-- 10.26 팀추가 -->
   <insert id="teamInsert" useGeneratedKeys="true" keyProperty="tst_team_no">
      INSERT 
      INTO 
                  TST_TEAM
                  (
                  TST_TEAM_NAME, 
                  TST_TEAM_TYPE, 
                  TST_TEAM_LOCATION, 
                  TST_USER_NICKNAME, 
                  TST_TEAM_CONTENT,
                  TST_TEAM_AGE
                  
                  )
      VALUES
                  (
                  #{ tst_team_name }, 
                  #{ tst_team_type},
                  #{ tst_team_location }, 
                  #{ tst_user_nickname },
                  #{ tst_team_content },
                  #{ tst_team_age }
                  )
   </insert>
   
   	<!-- 10.28 팀 멤버 목록 -->
    <select id="memberList" resultType="TST_teamproject.user.model.UserVo">
      SELECT 
      
                  A.TST_USER_NICKNAME,
                  A.TST_USER_BRITH, 
                  A.TST_USER_LOCATION,
                  A.TST_USER_ID
                  
      FROM 
                  TST_USER AS A 
      INNER JOIN 
                  TST_USER_TEAM AS B 
      ON 
                  A.TST_USER_NICKNAME=B.TST_USER_NICKNAME 
      WHERE 
                  B.TST_TEAM_NO = #{tst_team_no}
                         
    </select>
    
   <!-- 10.28 팀 디테일 생성 -->
   <select id="teamFindOne" resultType="TST_teamproject.team.model.TeamVo">
      SELECT
                  TST_TEAM_NO,
                  TST_TEAM_NAME, 
                  TST_TEAM_TYPE, 
                  TST_TEAM_LOCATION, 
                  TST_TEAM_CONTENT, 
                  TST_TEAM_WIN, 
                  TST_TEAM_LOSE,
                  TST_USER_NICKNAME,
                  TST_TEAM_AGE
                  
      FROM 
                  TST_TEAM             
      WHERE
      
                  TST_TEAM_NO = #{ TST_TEAM_NO }
   </select>
   
   <!-- 10.29 팀 삭제 -->
   <delete id="teamDelete">
      delete 
      from 
                  TST_TEAM 
      where 
                  tst_team_no = #{tst_team_no}
   </delete>
   
   
    <insert id="addMember">
      INSERT 
      INTO 
                  TST_USER_TEAM( 
                     TST_USER_NICKNAME, 
                     TST_TEAM_NO, 
                     TST_USER_ID,
                     TST_USER_TEAM_AUTHORITY,
                     TST_USER_TEAM_ESCAPE
                     )
      VALUES
                     (
                     #{tst_user_nickname},
                     #{tst_team_no},
                     #{tst_user_id},
                     #{tst_user_team_authority},
                     #{tst_user_team_escape}
                     )
                     
   </insert>
   
   <!-- 11.1 팀수정하기 -->
   <update id="teamUpdate" parameterType="TST_teamproject.team.model.TeamVo">
      UPDATE 
                  TST_TEAM
      SET
                  TST_USER_NICKNAME = #{ tst_user_nickname },
                  TST_TEAM_CONTENT = #{ tst_team_content},
                  TST_TEAM_AGE =  #{tst_team_age}
      WHERE 
                  TST_TEAM_NO = #{ tst_team_no }
   </update>
   
   <!-- 11.1 팀 권한  바꿔주기-->
   <update id="teamAuthority" parameterType="TST_teamproject.team.model.MemberVo">
      UPDATE 
                  TST_USER_TEAM
      SET
                  TST_USER_TEAM_AUTHORITY = #{ tst_user_team_authority }
      WHERE 
                  TST_TEAM_NO = #{ tst_team_no }
      AND 
                  TST_USER_NICKNAME = #{ tst_user_nickname }
   </update>
   
   <!-- 11.02 팀 개수 새기 -->
   <select id="listCount" resultType="int">
      SELECT
                  COUNT(*)
      FROM
                  TST_TEAM
                  
   <if test="keyword != null">
      WHERE 
      TST_TEAM_NAME 
      LIKE CONCAT 
                  ('%', #{keyword}, '%') 
      OR 
      TST_TEAM_TYPE 
      LIKE CONCAT
                  ('%', #{keyword}, '%')
   </if>
    </select>
    
    <!-- side bar -->
    <select id="selectSideBarTeam" parameterType="String" resultType="TST_teamproject.team.model.TeamVo">
    SELECT
    				b.TST_TEAM_NO, 
    				b.TST_TEAM_NAME,
    				b.TST_USER_NICKNAME,
    				b.TST_TEAM_TYPE
	FROM 
					TST_USER_TEAM a
	INNER JOIN 
					TST_TEAM b ON a.TST_TEAM_NO=b.TST_TEAM_NO
	WHERE 
					a.TST_USER_NICKNAME = #{ tst_user_nickname }
    </select>
    
     <!-- 11.09 조준서 -->
    <select id="swichTeamname" resultType="TST_teamproject.team.model.TeamVo" parameterType="String">
    SELECT 
                TST_TEAM_NO,
                TST_USER_NICKNAME
   FROM 
               TST_TEAM
   WHERE 
               TST_TEAM_NAME=#{tst_team_name}
    
    </select>
    
     <!--11.28 조준서 작성  -->
    <select id="selectMainTeam" resultType="TST_teamproject.team.model.TeamBoardVo">
  	SELECT 
  							TST_TEAM_NAME,
  							TST_TEAM_TYPE,
  							TST_TEAM_LOCATION,
  							TST_USER_NICKNAME,
  							TST_TEAM_WIN,
  							TST_TEAM_LOSE,
  							TST_TEAM_AGE 
  	FROM 
  							TST_TEAM 
  							ORDER BY TST_TEAM_NO DESC LIMIT 4
    </select>
</mapper>